"use strict";!function(a){if(a.Pen){var b={};b.valid=function(a){return["#","##","###","####","#####","######"].includes(a)?"h"+a.length:"```"===a?"codeblock":">"===a?"blockquote":"1."===a?"insertorderedlist":"-"===a||"*"===a?"insertunorderedlist":a.match(/^(?:\.|\*|\-){3,}/)?"inserthorizontalrule":void 0},b.action=function(a,b){var c=a.selection.focusNode;c.parentNode!==a.config.editor&&(c.textContent.length===a.selection.getRangeAt(0).endOffset?c.parentNode.innerHTML="<br>":c.textContent=c.textContent.slice(a.selection.getRangeAt(0).startOffset)),a.execCommand(b)},b.init=function(a){a.on("keypress",function(c){var d=c.keyCode||c.which;if(32===d){var e=a.getRange(),f=e.startContainer,g=e.endContainer,h=e.startOffset,i=e.endOffset,j=a.selection.focusNode.nodeValue;if(f===g&&h===i&&j){var k=b.valid(j.slice(0,h));k&&(c.preventDefault(),b.action(a,k))}}})},a.Pen.prototype.markdown=b}}(window),!function(a){if(a.Pen){var b={};b.valid=function(a){return["#","##","###","####","#####","######"].includes(a)?"h"+a.length:"```"===a?"codeblock":">"===a?"blockquote":"1."===a?"insertorderedlist":"-"===a||"*"===a?"insertunorderedlist":a.match(/^(?:\.|\*|\-){3,}/)?"inserthorizontalrule":void 0},b.action=function(a,b){var c=a.selection.focusNode;c.parentNode!==a.config.editor&&(c.textContent.length===a.selection.getRangeAt(0).endOffset?c.parentNode.innerHTML="<br>":c.textContent=c.textContent.slice(a.selection.getRangeAt(0).startOffset)),a.execCommand(b)},b.init=function(a){a.on("keypress",function(c){var d=c.keyCode||c.which;if(32===d){var e=a.getRange(),f=e.startContainer,g=e.endContainer,h=e.startOffset,i=e.endOffset,j=a.selection.focusNode.nodeValue;if(f===g&&h===i&&j){var k=b.valid(j.slice(0,h));k&&(c.preventDefault(),b.action(a,k))}}})},a.Pen.prototype.markdown=b}}(window);var TurndownService=function(){function a(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a}function b(a,b){return Array(b+1).join(a)}function c(a){return-1!==B.indexOf(a.nodeName.toLowerCase())}function d(a){return-1!==C.indexOf(a.nodeName.toLowerCase())}function e(a){return a.querySelector&&a.querySelector(D)}function f(a){this.options=a,this._keep=[],this._remove=[],this.blankRule={replacement:a.blankReplacement},this.keepReplacement=a.keepReplacement,this.defaultRule={replacement:a.defaultReplacement},this.array=[];for(var b in a.rules)this.array.push(a.rules[b])}function g(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(h(e,b,c))return e}return void 0}function h(a,b,c){var d=a.filter;if("string"==typeof d){if(d===b.nodeName.toLowerCase())return!0}else if(Array.isArray(d)){if(d.indexOf(b.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof d)throw new TypeError("`filter` needs to be a string, array, or function");if(d.call(a,b,c))return!0}}function i(a){var b=a.element,c=a.isBlock,d=a.isVoid,e=a.isPre||function(a){return"PRE"===a.nodeName};if(b.firstChild&&!e(b)){for(var f=null,g=!1,h=null,i=k(h,b,e);i!==b;){if(3===i.nodeType||4===i.nodeType){var l=i.data.replace(/[ \r\n\t]+/g," ");if(f&&!/ $/.test(f.data)||g||" "!==l[0]||(l=l.substr(1)),!l){i=j(i);continue}i.data=l,f=i}else{if(1!==i.nodeType){i=j(i);continue}c(i)||"BR"===i.nodeName?(f&&(f.data=f.data.replace(/ $/,"")),f=null,g=!1):d(i)&&(f=null,g=!0)}var m=k(h,i,e);h=i,i=m}f&&(f.data=f.data.replace(/ $/,""),f.data||j(f))}}function j(a){var b=a.nextSibling||a.parentNode;return a.parentNode.removeChild(a),b}function k(a,b,c){return a&&a.parentNode===b||c(b)?b.nextSibling||b.parentNode:b.firstChild||b.nextSibling||b.parentNode}function l(){var a=G.DOMParser,b=!1;try{(new a).parseFromString("","text/html")&&(b=!0)}catch(c){}return b}function m(){var a=function(){};return n()?a.prototype.parseFromString=function(a){var b=new window.ActiveXObject("htmlfile");return b.designMode="on",b.open(),b.write(a),b.close(),b}:a.prototype.parseFromString=function(a){var b=document.implementation.createHTMLDocument("");return b.open(),b.write(a),b.close(),b},a}function n(){var a=!1;try{document.implementation.createHTMLDocument("").open()}catch(b){window.ActiveXObject&&(a=!0)}return a}function o(a){var b;if("string"==typeof a){var e=p().parseFromString('<x-turndown id="turndown-root">'+a+"</x-turndown>","text/html");b=e.getElementById("turndown-root")}else b=a.cloneNode(!0);return i({element:b,isBlock:c,isVoid:d}),b}function p(){return F=F||new H}function q(a){return a.isBlock=c(a),a.isCode="code"===a.nodeName.toLowerCase()||a.parentNode.isCode,a.isBlank=r(a),a.flankingWhitespace=s(a),a}function r(a){return-1===["A","TH","TD"].indexOf(a.nodeName)&&/^\s*$/i.test(a.textContent)&&!d(a)&&!e(a)}function s(a){var b="",c="";if(!a.isBlock){var d=/^[ \r\n\t]/.test(a.textContent),e=/[ \r\n\t]$/.test(a.textContent);d&&!t("left",a)&&(b=" "),e&&!t("right",a)&&(c=" ")}return{leading:b,trailing:c}}function t(a,b){var d,e,f;return"left"===a?(d=b.previousSibling,e=/ $/):(d=b.nextSibling,e=/^ /),d&&(3===d.nodeType?f=e.test(d.nodeValue):1!==d.nodeType||c(d)||(f=e.test(d.textContent))),f}function u(b){if(!(this instanceof u))return new u(b);var c={rules:E,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",blankReplacement:function(a,b){return b.isBlock?"\n\n":""},keepReplacement:function(a,b){return b.isBlock?"\n\n"+b.outerHTML+"\n\n":b.outerHTML},defaultReplacement:function(a,b){return b.isBlock?"\n\n"+a+"\n\n":a}};this.options=a({},c,b),this.rules=new f(this.options)}function v(a){var b=this;return I.call(a.childNodes,function(a,c){c=new q(c);var d="";return 3===c.nodeType?d=c.isCode?c.nodeValue:b.escape(c.nodeValue):1===c.nodeType&&(d=x.call(b,c)),z(a,d)},"")}function w(a){var b=this;return this.rules.forEach(function(c){"function"==typeof c.append&&(a=z(a,c.append(b.options)))}),a.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function x(a){var b=this.rules.forNode(a),c=v.call(this,a),d=a.flankingWhitespace;return(d.leading||d.trailing)&&(c=c.trim()),d.leading+b.replacement(c,a,this.options)+d.trailing}function y(a,b){var c=[a.match(K)[0],b.match(J)[0]].sort(),d=c[c.length-1];return d.length<2?d:"\n\n"}function z(a,b){var c=y(a,b);return a=a.replace(K,""),b=b.replace(J,""),a+c+b}function A(a){return null!=a&&("string"==typeof a||a.nodeType&&(1===a.nodeType||9===a.nodeType||11===a.nodeType))}var B=["address","article","aside","audio","blockquote","body","canvas","center","dd","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frameset","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","isindex","li","main","menu","nav","noframes","noscript","ol","output","p","pre","section","table","tbody","td","tfoot","th","thead","tr","ul"],C=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],D=C.join(),E={};E.paragraph={filter:"p",replacement:function(a){return"\n\n"+a+"\n\n"}},E.lineBreak={filter:"br",replacement:function(a,b,c){return c.br+"\n"}},E.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(a,c,d){var e=Number(c.nodeName.charAt(1));if("setext"===d.headingStyle&&3>e){var f=b(1===e?"=":"-",a.length);return"\n\n"+a+"\n"+f+"\n\n"}return"\n\n"+b("#",e)+" "+a+"\n\n"}},E.blockquote={filter:"blockquote",replacement:function(a){return a=a.replace(/^\n+|\n+$/g,""),a=a.replace(/^/gm,"> "),"\n\n"+a+"\n\n"}},E.list={filter:["ul","ol"],replacement:function(a,b){var c=b.parentNode;return"LI"===c.nodeName&&c.lastElementChild===b?"\n"+a:"\n\n"+a+"\n\n"}},E.listItem={filter:"li",replacement:function(a,b,c){a=a.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var d=c.bulletListMarker+"   ",e=b.parentNode;if("OL"===e.nodeName){var f=e.getAttribute("start"),g=Array.prototype.indexOf.call(e.children,b);d=(f?Number(f)+g:g+1)+".  "}return d+a+(b.nextSibling&&!/\n$/.test(a)?"\n":"")}},E.indentedCodeBlock={filter:function(a,b){return"indented"===b.codeBlockStyle&&"PRE"===a.nodeName&&a.firstChild&&"CODE"===a.firstChild.nodeName},replacement:function(a,b,c){return"\n\n    "+b.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},E.fencedCodeBlock={filter:function(a,b){return"fenced"===b.codeBlockStyle&&"PRE"===a.nodeName&&a.firstChild&&"CODE"===a.firstChild.nodeName},replacement:function(a,b,c){var d=b.firstChild.className||"",e=(d.match(/language-(\S+)/)||[null,""])[1];return"\n\n"+c.fence+e+"\n"+b.firstChild.textContent+"\n"+c.fence+"\n\n"}},E.horizontalRule={filter:"hr",replacement:function(a,b,c){return"\n\n"+c.hr+"\n\n"}},E.inlineLink={filter:function(a,b){return"inlined"===b.linkStyle&&"A"===a.nodeName&&a.getAttribute("href")},replacement:function(a,b){var c=b.getAttribute("href"),d=b.title?' "'+b.title+'"':"";return"["+a+"]("+c+d+")"}},E.referenceLink={filter:function(a,b){return"referenced"===b.linkStyle&&"A"===a.nodeName&&a.getAttribute("href")},replacement:function L(a,b,c){var L,d,e=b.getAttribute("href"),f=b.title?' "'+b.title+'"':"";switch(c.linkReferenceStyle){case"collapsed":L="["+a+"][]",d="["+a+"]: "+e+f;break;case"shortcut":L="["+a+"]",d="["+a+"]: "+e+f;break;default:var g=this.references.length+1;L="["+a+"]["+g+"]",d="["+g+"]: "+e+f}return this.references.push(d),L},references:[],append:function(a){var b="";return this.references.length&&(b="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),b}},E.emphasis={filter:["em","i"],replacement:function(a,b,c){return a.trim()?c.emDelimiter+a+c.emDelimiter:""}},E.strong={filter:["strong","b"],replacement:function(a,b,c){return a.trim()?c.strongDelimiter+a+c.strongDelimiter:""}},E.code={filter:function(a){var b=a.previousSibling||a.nextSibling,c="PRE"===a.parentNode.nodeName&&!b;return"CODE"===a.nodeName&&!c},replacement:function(a){if(!a.trim())return"";var b="`",c="",d="",e=a.match(/`+/gm);if(e)for(/^`/.test(a)&&(c=" "),/`$/.test(a)&&(d=" ");-1!==e.indexOf(b);)b+="`";return b+c+a+d+b}},E.image={filter:"img",replacement:function(a,b){var c=b.alt||"",d=b.getAttribute("src")||"",e=b.title||"",f=e?' "'+e+'"':"";return d?"!["+c+"]("+d+f+")":""}},f.prototype={add:function(a,b){this.array.unshift(b)},keep:function(a){this._keep.unshift({filter:a,replacement:this.keepReplacement})},remove:function(a){this._remove.unshift({filter:a,replacement:function(){return""}})},forNode:function(a){if(a.isBlank)return this.blankRule;var b;return(b=g(this.array,a,this.options))?b:(b=g(this._keep,a,this.options))?b:(b=g(this._remove,a,this.options))?b:this.defaultRule},forEach:function(a){for(var b=0;b<this.array.length;b++)a(this.array[b],b)}};var F,G="undefined"!=typeof window?window:{},H=l()?G.DOMParser:m(),I=Array.prototype.reduce,J=/^\n*/,K=/\n*$/;return u.prototype={turndown:function(a){if(!A(a))throw new TypeError(a+" is not a string, or an element/document/fragment node.");if(""===a)return"";var b=v.call(this,new o(a));return w.call(this,b)},use:function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this.use(a[b]);else{if("function"!=typeof a)throw new TypeError("plugin must be a Function or an Array of Functions");a(this)}return this},addRule:function(a,b){return this.rules.add(a,b),this},keep:function(a){return this.rules.keep(a),this},remove:function(a){return this.rules.remove(a),this},escape:function(a){return a.replace(/\\(\S)/g,"\\\\$1").replace(/^(#{1,6} )/gm,"\\$1").replace(/^([-*_] *){3,}$/gm,function(a,b){return a.split(b).join("\\"+b)}).replace(/^(\W* {0,3})(\d+)\. /gm,"$1$2\\. ").replace(/^([^\\\w]*)[*+-] /gm,function(a){return a.replace(/([*+-])/g,"\\$1")}).replace(/^(\W* {0,3})> /gm,"$1\\> ").replace(/\*+(?![*\s\W]).+?\*+/g,function(a){return a.replace(/\*/g,"\\*")}).replace(/_+(?![_\s\W]).+?_+/g,function(a){return a.replace(/_/g,"\\_")}).replace(/`+(?![`\s\W]).+?`+/g,function(a){return a.replace(/`/g,"\\`")}).replace(/[\[\]]/g,"\\$&")}},u}();!function(a,b){function c(a,c,d){var e=" to exec 「"+c+"」 command"+(d?" with value: "+d:"");try{b.execCommand(c,!1,d)}catch(f){return B.log("fail"+e,!0)}B.log("success"+e)}function d(a,b,d){var e=q(a);return e?(a._range.selectNode(e),a._range.collapse(!1),"insertimage"===b&&a._menu&&w(a._menu,!0),c(a,b,d)):void 0}function e(a,b){var d=r(a,q(a),!0);return-1!==d.indexOf(b)&&(b="p"),c(a,"formatblock",b)}function f(a,b,d){return d="<"+b+">"+(d||A.toString())+"</"+b+">",c(a,"insertHTML",d)}function g(a,b,d){return a.config.linksInNewWindow?(d='<a href="'+d+'" target="_blank">'+A.toString()+"</a>",c(a,"insertHTML",d)):c(a,b,d)}function h(a){var c="",d='<input class="pen-input" placeholder="http://" />';if(a._toolbar=a.config.toolbar,a._toolbar)(a._toolbar.querySelectorAll("[data-action=createlink]").length||a._toolbar.querySelectorAll("[data-action=insertimage]").length)&&(c+=d);else{var e=a.config.list;B.forEach(e,function(b){var d="pen-icon icon-"+b,e=a.config.titles[b]||"";c+='<i class="'+d+'" data-action="'+b+'" title="'+e+'"></i>'},!0),(e.indexOf("createlink")>=0||e.indexOf("insertimage")>=0)&&(c+=d)}c&&(a._menu=b.createElement("div"),a._menu.setAttribute("class",a.config["class"]+"-menu pen-menu"),a._menu.innerHTML=c,a._inputBar=a._menu.querySelector("input"),w(a._menu,!0),b.body.appendChild(a._menu)),a._toolbar&&a._inputBar&&w(a._inputBar)}function i(c){function d(a){c._range=c.getRange(),g(a)}var e=c._toolbar||c._menu,f=c.config.editor,g=B.delayExec(function(){c.highlight().menu()}),h=function(){};if(c._menu){var i=function(){"block"===c._menu.style.display&&c.menu()};j(c,a,"resize",i),j(c,a,"scroll",i);var k=!1;j(c,f,"mousedown",function(){k=!0}),j(c,f,"mouseleave",function(){k&&d(800),k=!1}),j(c,f,"mouseup",function(){k&&d(100),k=!1}),h=function(a){!c._menu||"block"!==c._menu.style.display||p(f,a.target)||p(c._menu,a.target)||(l(c,b,"click",h),g(100))}}else j(c,f,"click",function(){d(0)});j(c,f,"keyup",function(a){return 8===a.which&&c.isEmpty()?s(c,!0):void 0}),j(c,f,"keydown",function(a){if(f.classList.remove("pen-placeholder"),13===a.which&&!a.shiftKey){var d=q(c,!0);if(d&&F.test(d.nodeName)){"CODE"===d.nodeName&&(d=d.parentNode),a.preventDefault();var e=b.createElement("p");e.innerHTML="<br>",d.nextSibling?d.parentNode.insertBefore(e,d.nextSibling):d.parentNode.appendChild(e),t(c,e,c.getRange())}}});var m=function(a,b){c.execCommand(a,b),c._range=c.getRange(),c.highlight().menu()};j(c,e,"click",function(a){for(var b=a.target,d=void 0;b!==e&&!(d=b.getAttribute("data-action"));)b=b.parentNode;if(d){if(!/(?:createlink)|(?:insertimage)/.test(d))return m(d);if(c._inputBar){var f=c._inputBar;if(e===c._menu?w(f):(c._inputActive=!0,c.menu()),"none"!==c._menu.style.display){setTimeout(function(){f.focus()},400);var g=function(){var a=f.value;a?a=f.value.replace(H.whiteSpace,"").replace(H.mailTo,"mailto:$1").replace(H.http,"http://$1"):d="unlink",m(d,a),e===c._menu?w(f,!1):w(c._menu,!0)};f.onkeypress=function(a){return 13===a.which?g():void 0}}}}}),j(c,f,"focus",function(){c.isEmpty()&&s(c,!0),j(c,b,"click",h)}),j(c,f,"blur",function(){n(c),c.checkContentChange()}),j(c,f,"paste",function(){setTimeout(function(){c.cleanContent()})})}function j(a,b,c,d){if(a._events.hasOwnProperty(c))a._events[c].push(d);else{a._eventTargets=a._eventTargets||[],a._eventsCache=a._eventsCache||[];var e=a._eventTargets.indexOf(b);0>e&&(e=a._eventTargets.push(b)-1),a._eventsCache[e]=a._eventsCache[e]||{},a._eventsCache[e][c]=a._eventsCache[e][c]||[],a._eventsCache[e][c].push(d),b.addEventListener(c,d,!1)}return a}function k(a,b){if(a._events.hasOwnProperty(b)){var c=D.call(arguments,2);B.forEach(a._events[b],function(b){b.apply(a,c)})}}function l(a,b,c,d){var e=a._events[c];if(!e){var f=a._eventTargets.indexOf(b);f>=0&&(e=a._eventsCache[f][c])}if(!e)return a;var g=e.indexOf(d);return g>=0&&e.splice(g,1),b.removeEventListener(c,d,!1),a}function m(a){return B.forEach(this._events,function(a){a.length=0},!1),a._eventsCache?(B.forEach(a._eventsCache,function(b,c){var d=a._eventTargets[c];B.forEach(b,function(a,b){B.forEach(a,function(a){d.removeEventListener(b,a,!1)},!0)},!1)},!0),a._eventTargets=[],a._eventsCache=[],a):a}function n(a){a.config.editor.classList[a.isEmpty()?"add":"remove"]("pen-placeholder")}function o(a){return(a||"").replace(/^\s+|\s+$/g,"")}function p(a,b){if(a===b)return!0;for(b=b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1}function q(a,b){var c=void 0,d=a.config.editor;if(a._range=a.getRange(),c=a._range.commonAncestorContainer,!c||c===d)return null;for(;c&&1!==c.nodeType&&c.parentNode!==d;)c=c.parentNode;if(b)for(;c&&c.parentNode!==d;)c=c.parentNode;return p(d,c)?c:null}function r(a,b,c){var d=[];for(b=b||a.config.editor;b&&b!==a.config.editor;)b.nodeName.match(G)&&d.push(c?b.nodeName.toLowerCase():b),b=b.parentNode;return d}function s(a,c){var d=a._range=a.getRange(),e=b.createElement("p");c&&(a.config.editor.innerHTML=""),e.innerHTML="<br>",d.insertNode(e),t(a,e.childNodes[0],d)}function t(a,b,c){c.setStartAfter(b),c.setEndBefore(b),c.collapse(!1),a.setRange(c)}function u(a){if(1===a.nodeType){if(I.notLink.test(a.tagName))return;B.forEach(a.childNodes,function(a){u(a)},!0)}else if(3===a.nodeType){var c=v(a.nodeValue||"");if(!c.links)return;var d=b.createDocumentFragment(),e=b.createElement("div");for(e.innerHTML=c.text;e.childNodes.length;)d.appendChild(e.childNodes[0]);a.parentNode.replaceChild(d,a)}}function v(a){var b=0;return a=a.replace(I.url,function(a){var c=a,d=a;return b++,a.length>I.maxLength&&(d=a.slice(0,I.maxLength)+"..."),I.prefix.test(c)||(c="http://"+c),'<a href="'+c+'">'+d+"</a>"}),{links:b,text:a}}function w(a,b){a.style.display=b?"none":"block"}function x(a){if(a.hasChildNodes())return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null}function y(a){var b=a.startContainer,c=a.endContainer;if(b===c)return[b];for(var d=[];b&&b!==c;)d.push(b=x(b));for(b=a.startContainer;b&&b!==a.commonAncestorContainer;)d.unshift(b),b=b.parentNode;return d}var z=void 0,A=void 0,B={},C=Object.prototype.toString,D=Array.prototype.slice,E={block:/^(?:p|h[1-6]|blockquote)$/,inline:/^(?:bold|italic|underline|insertorderedlist|insertunorderedlist|indent|outdent)$/,source:/^(?:createlink|unlink)$/,insert:/^(?:inserthorizontalrule|insertimage|insert)$/,wrap:/^(?:code)$/},F=/^(?:blockquote|pre|div|code)$/i,G=/(?:[pubia]|h[1-6]|blockquote|[uo]l|li|code)/i,H={whiteSpace:/(^\s+)|(\s+$)/g,mailTo:/^(?!mailto:|.+\/|.+#|.+\?)(.*@.*\..+)$/,http:/^(?!\w+?:\/\/|mailto:|\/|\.\/|\?|#)(.*)$/},I={url:/((https?|ftp):\/\/|www\.)[^\s<]{3,}/gi,prefix:/^(?:https?|ftp):\/\//i,notLink:/^(?:img|a|input|audio|video|source|code|pre|script|head|title|style)$/i,maxLength:100};B.is=function(a,b){return C.call(a).slice(8,-1)===b},B.forEach=function(a,b,c){if(a)if(null==c&&(c=B.is(a,"Array")),c)for(var d=0,e=a.length;e>d;d++)b(a[d],d,a);else for(var f in a)a.hasOwnProperty(f)&&b(a[f],f,a)},B.copy=function(a,b){return B.forEach(b,function(b,c){B.is(b,"Object")?a[c]=B.copy({},b):B.is(b,"Array")?a[c]=B.copy([],b):a[c]=b}),a},B.log=function(a,b){(z||b)&&console.log("%cPEN DEBUGGER: %c"+a,"font-family:arial,sans-serif;color:#1abf89;line-height:2em;","font-family:cursor,monospace;color:#333;")},B.delayExec=function(a){var b=null;return function(c){clearTimeout(b),b=setTimeout(function(){a()},c||1)}},B.merge=function(a){var c={"class":"pen",debug:!1,toolbar:null,stay:a.stay||!a.debug,stayMsg:"Are you going to leave here?",textarea:'<textarea name="content"></textarea>',list:["blockquote","h2","h3","p","code","insertorderedlist","insertunorderedlist","inserthorizontalrule","indent","outdent","bold","italic","underline","createlink","insertimage"],titles:{},cleanAttrs:["id","class","style","name"],cleanTags:["script"],linksInNewWindow:!1};return 1===a.nodeType?c.editor=a:a.match&&a.match(/^#[\S]+$/)?c.editor=b.getElementById(a.slice(1)):c=B.copy(c,a),c};var J=function(a){if(!a)throw new Error("Can't find config");z=a.debug;var b=B.merge(a),c=b.editor;if(!c||1!==c.nodeType)throw new Error("Can't find editor");c.classList.add(b["class"]),c.setAttribute("contenteditable","true"),this.config=b,b.placeholder&&c.setAttribute("data-placeholder",b.placeholder),n(this),this.selection=A,this._events={change:[]},h(this),i(this),this._prevContent=this.getContent(),this.markdown&&this.markdown.init(this),this.config.stay&&this.stay(this.config),this.config.input&&this.addOnSubmitListener(this.config.input)};J.prototype.on=function(a,b){return j(this,this.config.editor,a,b),this},J.prototype.addOnSubmitListener=function(a){var b=a.form,c=this;b.addEventListener("submit",function(){a.value=c.config.editor.innerHTML})},J.prototype.isEmpty=function(a){return a=a||this.config.editor,!(a.querySelector("img")||a.querySelector("blockquote")||a.querySelector("li")||o(a.textContent))},J.prototype.getContent=function(){return this.isEmpty()?"":o(this.config.editor.innerHTML)},J.prototype.setContent=function(a){return this.config.editor.innerHTML=a,this.cleanContent(),this},J.prototype.checkContentChange=function(){var a=this._prevContent,b=this.getContent();a!==b&&(this._prevContent=b,k(this,"change",b,a))},J.prototype.getRange=function(){var a=this.config.editor,c=A.rangeCount&&A.getRangeAt(0);return c||(c=b.createRange()),p(a,c.commonAncestorContainer)||(c.selectNodeContents(a),c.collapse(!1)),c},J.prototype.setRange=function(a){a=a||this._range,a||(a=this.getRange(),a.collapse(!1));try{A.removeAllRanges(),A.addRange(a)}catch(b){}return this},J.prototype.focus=function(a){return a||this.setRange(),this.config.editor.focus(),this},J.prototype.execCommand=function(a,h){if(a=a.toLowerCase(),"codeblock"===a)this.selection.focusNode.innerHTML="<code><br></code>",e(this,"pre");else if(E.block.test(a))e(this,a);else if(E.inline.test(a))c(this,a,h);else if(E.source.test(a))this.setRange(),g(this,a,h);else if(E.insert.test(a))this.setRange(),d(this,a,h);else if(E.wrap.test(a)){var i=y(this.selection.getRangeAt(0)),j=0;if(B.forEach(i,function(a){"P"===a.nodeName&&j++}),2>j){var k=r(this,this.selection.focusNode),l=void 0;if(B.forEach(k,function(a){"CODE"===a.nodeName&&(l=a)}),l){if(!c(this,"removeFormat")){var m=b.createDocumentFragment();B.forEach(l.childNodes,function(a){m.appendChild(a.cloneNode())}),l.replaceWith(m)}}else f(this,a,h)}}else B.log("can not find command function for name: "+a+(h?", value: "+h:""),!0);"indent"===a?this.checkContentChange():this.cleanContent({cleanAttrs:["style"]})},J.prototype.cleanContent=function(a){var b=this.config.editor;return a||(a=this.config),B.forEach(a.cleanAttrs,function(a){B.forEach(b.querySelectorAll("["+a+"]"),function(b){b.removeAttribute(a)},!0)},!0),B.forEach(a.cleanTags,function(a){B.forEach(b.querySelectorAll(a),function(a){a.parentNode.removeChild(a)},!0)},!0),n(this),this.checkContentChange(),this},J.prototype.autoLink=function(){return u(this.config.editor),this.getContent()},J.prototype.highlight=function(){var a=this._toolbar||this._menu,b=q(this);if(B.forEach(a.querySelectorAll(".active"),function(a){a.classList.remove("active")},!0),!b)return this;var c=r(this,b),d=this._inputBar;d&&a===this._menu&&(d.style.display="none",d.value="");var e=function(b){if(b){var c=a.querySelector("[data-action="+b+"]");return c&&c.classList.add("active")}};return B.forEach(c,function(a){var b=a.nodeName.toLowerCase();switch(b){case"a":d&&(d.value=a.getAttribute("href")),b="createlink";break;case"img":d&&(d.value=a.getAttribute("src")),b="insertimage";break;case"i":b="italic";break;case"u":b="underline";break;case"b":b="bold";break;case"pre":case"code":b="code";break;case"ul":b="insertunorderedlist";break;case"ol":b="insertorderedlist";break;case"li":b="indent"}e(b)},!0),this},J.prototype.menu=function(){if(!this._menu)return this;if(A.isCollapsed)return this._menu.style.display="none",this._inputActive=!1,this;if(this._toolbar&&(!this._inputBar||!this._inputActive))return this;var a=this._range.getBoundingClientRect(),b=10,c=a.top-b,d=a.left+a.width/2,e=this._menu,f={x:0,y:0},g=this._stylesheet;if(0===a.width&&0===a.height)return this;if(void 0===this._stylesheet){var h=document.createElement("style");document.head.appendChild(h),this._stylesheet=g=h.sheet}return e.style.display="block",f.x=d-e.clientWidth/2,f.y=c-e.clientHeight,g.cssRules.length>0&&g.deleteRule(0),f.x<0?(f.x=0,g.insertRule(".pen-menu:after {left: "+d+"px;}",0)):g.insertRule(".pen-menu:after {left: 50%; }",0),f.y<0?(e.classList.add("pen-menu-below"),f.y=a.top+a.height+b):e.classList.remove("pen-menu-below"),e.style.top=f.y+"px",e.style.left=f.x+"px",this},J.prototype.stay=function(a){var b=this;window.onbeforeunload||(window.onbeforeunload=function(){return b._isDestroyed?void 0:a.stayMsg})},J.prototype.destroy=function(a){var b=!a,c=a?"setAttribute":"removeAttribute";if(a)h(this),i(this);else{m(this);try{A.removeAllRanges(),this._menu&&this._menu.parentNode.removeChild(this._menu)}catch(d){}}return this._isDestroyed=b,this.config.editor[c]("contenteditable",""),this},J.prototype.rebuild=function(){return this.destroy("it's a joke")},a.Pen=function(a){if(!a)return B.log("can't find config",!0);var b=B.merge(a),c=b.editor.getAttribute("class");return c=c?c.replace(/\bpen\b/g,"")+" pen-textarea "+b["class"]:"pen pen-textarea",b.editor.setAttribute("class",c),b.editor.innerHTML=b.textarea,b.editor},J.prototype.toMd=function(){var a=this.getContent(),b=new TurndownService({codeBlockStyle:"fenced",headingStyle:"atx"});return b.turndown(a)},b.getSelection&&(A=b.getSelection(),a.Pen=J)}(window,document);var TurndownService=function(){function a(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a}function b(a,b){return Array(b+1).join(a)}function c(a){return-1!==B.indexOf(a.nodeName.toLowerCase())}function d(a){return-1!==C.indexOf(a.nodeName.toLowerCase())}function e(a){return a.querySelector&&a.querySelector(D)}function f(a){this.options=a,this._keep=[],this._remove=[],this.blankRule={replacement:a.blankReplacement},this.keepReplacement=a.keepReplacement,this.defaultRule={replacement:a.defaultReplacement},this.array=[];for(var b in a.rules)this.array.push(a.rules[b])}function g(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(h(e,b,c))return e}return void 0}function h(a,b,c){var d=a.filter;if("string"==typeof d){if(d===b.nodeName.toLowerCase())return!0}else if(Array.isArray(d)){if(d.indexOf(b.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof d)throw new TypeError("`filter` needs to be a string, array, or function");if(d.call(a,b,c))return!0}}function i(a){var b=a.element,c=a.isBlock,d=a.isVoid,e=a.isPre||function(a){return"PRE"===a.nodeName};if(b.firstChild&&!e(b)){for(var f=null,g=!1,h=null,i=k(h,b,e);i!==b;){if(3===i.nodeType||4===i.nodeType){var l=i.data.replace(/[ \r\n\t]+/g," ");if(f&&!/ $/.test(f.data)||g||" "!==l[0]||(l=l.substr(1)),!l){i=j(i);continue}i.data=l,f=i}else{if(1!==i.nodeType){i=j(i);continue}c(i)||"BR"===i.nodeName?(f&&(f.data=f.data.replace(/ $/,"")),f=null,g=!1):d(i)&&(f=null,g=!0)}var m=k(h,i,e);h=i,i=m}f&&(f.data=f.data.replace(/ $/,""),f.data||j(f))}}function j(a){var b=a.nextSibling||a.parentNode;return a.parentNode.removeChild(a),b}function k(a,b,c){return a&&a.parentNode===b||c(b)?b.nextSibling||b.parentNode:b.firstChild||b.nextSibling||b.parentNode}function l(){var a=G.DOMParser,b=!1;try{(new a).parseFromString("","text/html")&&(b=!0)}catch(c){}return b}function m(){var a=function(){};return n()?a.prototype.parseFromString=function(a){var b=new window.ActiveXObject("htmlfile");return b.designMode="on",b.open(),b.write(a),b.close(),b}:a.prototype.parseFromString=function(a){var b=document.implementation.createHTMLDocument("");return b.open(),b.write(a),b.close(),b},a}function n(){var a=!1;try{document.implementation.createHTMLDocument("").open()}catch(b){window.ActiveXObject&&(a=!0)}return a}function o(a){var b;if("string"==typeof a){var e=p().parseFromString('<x-turndown id="turndown-root">'+a+"</x-turndown>","text/html");b=e.getElementById("turndown-root")}else b=a.cloneNode(!0);return i({element:b,isBlock:c,isVoid:d}),b}function p(){return F=F||new H}function q(a){return a.isBlock=c(a),a.isCode="code"===a.nodeName.toLowerCase()||a.parentNode.isCode,a.isBlank=r(a),a.flankingWhitespace=s(a),a}function r(a){return-1===["A","TH","TD"].indexOf(a.nodeName)&&/^\s*$/i.test(a.textContent)&&!d(a)&&!e(a)}function s(a){var b="",c="";if(!a.isBlock){var d=/^[ \r\n\t]/.test(a.textContent),e=/[ \r\n\t]$/.test(a.textContent);d&&!t("left",a)&&(b=" "),e&&!t("right",a)&&(c=" ")}return{leading:b,trailing:c}}function t(a,b){var d,e,f;return"left"===a?(d=b.previousSibling,e=/ $/):(d=b.nextSibling,e=/^ /),d&&(3===d.nodeType?f=e.test(d.nodeValue):1!==d.nodeType||c(d)||(f=e.test(d.textContent))),f}function u(b){if(!(this instanceof u))return new u(b);var c={rules:E,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",blankReplacement:function(a,b){return b.isBlock?"\n\n":""},keepReplacement:function(a,b){return b.isBlock?"\n\n"+b.outerHTML+"\n\n":b.outerHTML},defaultReplacement:function(a,b){return b.isBlock?"\n\n"+a+"\n\n":a}};this.options=a({},c,b),this.rules=new f(this.options)}function v(a){var b=this;return I.call(a.childNodes,function(a,c){c=new q(c);var d="";return 3===c.nodeType?d=c.isCode?c.nodeValue:b.escape(c.nodeValue):1===c.nodeType&&(d=x.call(b,c)),z(a,d)},"")}function w(a){var b=this;return this.rules.forEach(function(c){"function"==typeof c.append&&(a=z(a,c.append(b.options)))}),a.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function x(a){var b=this.rules.forNode(a),c=v.call(this,a),d=a.flankingWhitespace;return(d.leading||d.trailing)&&(c=c.trim()),d.leading+b.replacement(c,a,this.options)+d.trailing}function y(a,b){var c=[a.match(K)[0],b.match(J)[0]].sort(),d=c[c.length-1];return d.length<2?d:"\n\n"}function z(a,b){var c=y(a,b);return a=a.replace(K,""),b=b.replace(J,""),a+c+b}function A(a){return null!=a&&("string"==typeof a||a.nodeType&&(1===a.nodeType||9===a.nodeType||11===a.nodeType))}var B=["address","article","aside","audio","blockquote","body","canvas","center","dd","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frameset","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","isindex","li","main","menu","nav","noframes","noscript","ol","output","p","pre","section","table","tbody","td","tfoot","th","thead","tr","ul"],C=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],D=C.join(),E={};E.paragraph={filter:"p",replacement:function(a){return"\n\n"+a+"\n\n"}},E.lineBreak={filter:"br",replacement:function(a,b,c){return c.br+"\n"}},E.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(a,c,d){var e=Number(c.nodeName.charAt(1));if("setext"===d.headingStyle&&3>e){var f=b(1===e?"=":"-",a.length);return"\n\n"+a+"\n"+f+"\n\n"}return"\n\n"+b("#",e)+" "+a+"\n\n"}},E.blockquote={filter:"blockquote",replacement:function(a){return a=a.replace(/^\n+|\n+$/g,""),a=a.replace(/^/gm,"> "),"\n\n"+a+"\n\n"}},E.list={filter:["ul","ol"],replacement:function(a,b){var c=b.parentNode;return"LI"===c.nodeName&&c.lastElementChild===b?"\n"+a:"\n\n"+a+"\n\n"}},E.listItem={filter:"li",replacement:function(a,b,c){a=a.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var d=c.bulletListMarker+"   ",e=b.parentNode;if("OL"===e.nodeName){var f=e.getAttribute("start"),g=Array.prototype.indexOf.call(e.children,b);d=(f?Number(f)+g:g+1)+".  "}return d+a+(b.nextSibling&&!/\n$/.test(a)?"\n":"")}},E.indentedCodeBlock={filter:function(a,b){return"indented"===b.codeBlockStyle&&"PRE"===a.nodeName&&a.firstChild&&"CODE"===a.firstChild.nodeName},replacement:function(a,b,c){return"\n\n    "+b.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},E.fencedCodeBlock={filter:function(a,b){return"fenced"===b.codeBlockStyle&&"PRE"===a.nodeName&&a.firstChild&&"CODE"===a.firstChild.nodeName},replacement:function(a,b,c){var d=b.firstChild.className||"",e=(d.match(/language-(\S+)/)||[null,""])[1];return"\n\n"+c.fence+e+"\n"+b.firstChild.textContent+"\n"+c.fence+"\n\n";
}},E.horizontalRule={filter:"hr",replacement:function(a,b,c){return"\n\n"+c.hr+"\n\n"}},E.inlineLink={filter:function(a,b){return"inlined"===b.linkStyle&&"A"===a.nodeName&&a.getAttribute("href")},replacement:function(a,b){var c=b.getAttribute("href"),d=b.title?' "'+b.title+'"':"";return"["+a+"]("+c+d+")"}},E.referenceLink={filter:function(a,b){return"referenced"===b.linkStyle&&"A"===a.nodeName&&a.getAttribute("href")},replacement:function L(a,b,c){var L,d,e=b.getAttribute("href"),f=b.title?' "'+b.title+'"':"";switch(c.linkReferenceStyle){case"collapsed":L="["+a+"][]",d="["+a+"]: "+e+f;break;case"shortcut":L="["+a+"]",d="["+a+"]: "+e+f;break;default:var g=this.references.length+1;L="["+a+"]["+g+"]",d="["+g+"]: "+e+f}return this.references.push(d),L},references:[],append:function(a){var b="";return this.references.length&&(b="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),b}},E.emphasis={filter:["em","i"],replacement:function(a,b,c){return a.trim()?c.emDelimiter+a+c.emDelimiter:""}},E.strong={filter:["strong","b"],replacement:function(a,b,c){return a.trim()?c.strongDelimiter+a+c.strongDelimiter:""}},E.code={filter:function(a){var b=a.previousSibling||a.nextSibling,c="PRE"===a.parentNode.nodeName&&!b;return"CODE"===a.nodeName&&!c},replacement:function(a){if(!a.trim())return"";var b="`",c="",d="",e=a.match(/`+/gm);if(e)for(/^`/.test(a)&&(c=" "),/`$/.test(a)&&(d=" ");-1!==e.indexOf(b);)b+="`";return b+c+a+d+b}},E.image={filter:"img",replacement:function(a,b){var c=b.alt||"",d=b.getAttribute("src")||"",e=b.title||"",f=e?' "'+e+'"':"";return d?"!["+c+"]("+d+f+")":""}},f.prototype={add:function(a,b){this.array.unshift(b)},keep:function(a){this._keep.unshift({filter:a,replacement:this.keepReplacement})},remove:function(a){this._remove.unshift({filter:a,replacement:function(){return""}})},forNode:function(a){if(a.isBlank)return this.blankRule;var b;return(b=g(this.array,a,this.options))?b:(b=g(this._keep,a,this.options))?b:(b=g(this._remove,a,this.options))?b:this.defaultRule},forEach:function(a){for(var b=0;b<this.array.length;b++)a(this.array[b],b)}};var F,G="undefined"!=typeof window?window:{},H=l()?G.DOMParser:m(),I=Array.prototype.reduce,J=/^\n*/,K=/\n*$/;return u.prototype={turndown:function(a){if(!A(a))throw new TypeError(a+" is not a string, or an element/document/fragment node.");if(""===a)return"";var b=v.call(this,new o(a));return w.call(this,b)},use:function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this.use(a[b]);else{if("function"!=typeof a)throw new TypeError("plugin must be a Function or an Array of Functions");a(this)}return this},addRule:function(a,b){return this.rules.add(a,b),this},keep:function(a){return this.rules.keep(a),this},remove:function(a){return this.rules.remove(a),this},escape:function(a){return a.replace(/\\(\S)/g,"\\\\$1").replace(/^(#{1,6} )/gm,"\\$1").replace(/^([-*_] *){3,}$/gm,function(a,b){return a.split(b).join("\\"+b)}).replace(/^(\W* {0,3})(\d+)\. /gm,"$1$2\\. ").replace(/^([^\\\w]*)[*+-] /gm,function(a){return a.replace(/([*+-])/g,"\\$1")}).replace(/^(\W* {0,3})> /gm,"$1\\> ").replace(/\*+(?![*\s\W]).+?\*+/g,function(a){return a.replace(/\*/g,"\\*")}).replace(/_+(?![_\s\W]).+?_+/g,function(a){return a.replace(/_/g,"\\_")}).replace(/`+(?![`\s\W]).+?`+/g,function(a){return a.replace(/`/g,"\\`")}).replace(/[\[\]]/g,"\\$&")}},u}();!function(a,b){function c(a,c,d){var e=" to exec 「"+c+"」 command"+(d?" with value: "+d:"");try{b.execCommand(c,!1,d)}catch(f){return B.log("fail"+e,!0)}B.log("success"+e)}function d(a,b,d){var e=q(a);if(e)return a._range.selectNode(e),a._range.collapse(!1),"insertimage"===b&&a._menu&&w(a._menu,!0),c(a,b,d)}function e(a,b){var d=r(a,q(a),!0);return-1!==d.indexOf(b)&&(b="p"),c(a,"formatblock",b)}function f(a,b,d){return d="<"+b+">"+(d||A.toString())+"</"+b+">",c(a,"insertHTML",d)}function g(a,b,d){return a.config.linksInNewWindow?(d='<a href="'+d+'" target="_blank">'+A.toString()+"</a>",c(a,"insertHTML",d)):c(a,b,d)}function h(a){var c="",d='<input class="pen-input" placeholder="http://" />';if(a._toolbar=a.config.toolbar,a._toolbar)(a._toolbar.querySelectorAll("[data-action=createlink]").length||a._toolbar.querySelectorAll("[data-action=insertimage]").length)&&(c+=d);else{var e=a.config.list;B.forEach(e,function(b){var d="pen-icon icon-"+b,e=a.config.titles[b]||"";c+='<i class="'+d+'" data-action="'+b+'" title="'+e+'"></i>'},!0),(e.indexOf("createlink")>=0||e.indexOf("insertimage")>=0)&&(c+=d)}c&&(a._menu=b.createElement("div"),a._menu.setAttribute("class",a.config["class"]+"-menu pen-menu"),a._menu.innerHTML=c,a._inputBar=a._menu.querySelector("input"),w(a._menu,!0),b.body.appendChild(a._menu)),a._toolbar&&a._inputBar&&w(a._inputBar)}function i(c){function d(a){c._range=c.getRange(),g(a)}var e=c._toolbar||c._menu,f=c.config.editor,g=B.delayExec(function(){c.highlight().menu()}),h=function(){};if(c._menu){var i=function(){"block"===c._menu.style.display&&c.menu()};j(c,a,"resize",i),j(c,a,"scroll",i);var k=!1;j(c,f,"mousedown",function(){k=!0}),j(c,f,"mouseleave",function(){k&&d(800),k=!1}),j(c,f,"mouseup",function(){k&&d(100),k=!1}),h=function(a){!c._menu||"block"!==c._menu.style.display||p(f,a.target)||p(c._menu,a.target)||(l(c,b,"click",h),g(100))}}else j(c,f,"click",function(){d(0)});j(c,f,"keyup",function(a){return 8===a.which&&c.isEmpty()?s(c,!0):void 0}),j(c,f,"keydown",function(a){if(f.classList.remove("pen-placeholder"),13===a.which&&!a.shiftKey){var d=q(c,!0);if(d&&F.test(d.nodeName)){"CODE"===d.nodeName&&(d=d.parentNode),a.preventDefault();var e=b.createElement("p");e.innerHTML="<br>",d.nextSibling?d.parentNode.insertBefore(e,d.nextSibling):d.parentNode.appendChild(e),t(c,e,c.getRange())}}});var m=function(a,b){c.execCommand(a,b),c._range=c.getRange(),c.highlight().menu()};j(c,e,"click",function(a){for(var b=a.target,d=void 0;b!==e&&!(d=b.getAttribute("data-action"));)b=b.parentNode;if(d){if(!/(?:createlink)|(?:insertimage)/.test(d))return m(d);if(c._inputBar){var f=c._inputBar;if(e===c._menu?w(f):(c._inputActive=!0,c.menu()),"none"!==c._menu.style.display){setTimeout(function(){f.focus()},400);var g=function(){var a=f.value;a?a=f.value.replace(H.whiteSpace,"").replace(H.mailTo,"mailto:$1").replace(H.http,"http://$1"):d="unlink",m(d,a),e===c._menu?w(f,!1):w(c._menu,!0)};f.onkeypress=function(a){return 13===a.which?g():void 0}}}}}),j(c,f,"focus",function(){c.isEmpty()&&s(c,!0),j(c,b,"click",h)}),j(c,f,"blur",function(){n(c),c.checkContentChange()}),j(c,f,"paste",function(){setTimeout(function(){c.cleanContent()})})}function j(a,b,c,d){if(a._events.hasOwnProperty(c))a._events[c].push(d);else{a._eventTargets=a._eventTargets||[],a._eventsCache=a._eventsCache||[];var e=a._eventTargets.indexOf(b);0>e&&(e=a._eventTargets.push(b)-1),a._eventsCache[e]=a._eventsCache[e]||{},a._eventsCache[e][c]=a._eventsCache[e][c]||[],a._eventsCache[e][c].push(d),b.addEventListener(c,d,!1)}return a}function k(a,b){if(a._events.hasOwnProperty(b)){var c=D.call(arguments,2);B.forEach(a._events[b],function(b){b.apply(a,c)})}}function l(a,b,c,d){var e=a._events[c];if(!e){var f=a._eventTargets.indexOf(b);f>=0&&(e=a._eventsCache[f][c])}if(!e)return a;var g=e.indexOf(d);return g>=0&&e.splice(g,1),b.removeEventListener(c,d,!1),a}function m(a){return B.forEach(this._events,function(a){a.length=0},!1),a._eventsCache?(B.forEach(a._eventsCache,function(b,c){var d=a._eventTargets[c];B.forEach(b,function(a,b){B.forEach(a,function(a){d.removeEventListener(b,a,!1)},!0)},!1)},!0),a._eventTargets=[],a._eventsCache=[],a):a}function n(a){a.config.editor.classList[a.isEmpty()?"add":"remove"]("pen-placeholder")}function o(a){return(a||"").replace(/^\s+|\s+$/g,"")}function p(a,b){if(a===b)return!0;for(b=b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1}function q(a,b){var c=void 0,d=a.config.editor;if(a._range=a.getRange(),c=a._range.commonAncestorContainer,!c||c===d)return null;for(;c&&1!==c.nodeType&&c.parentNode!==d;)c=c.parentNode;if(b)for(;c&&c.parentNode!==d;)c=c.parentNode;return p(d,c)?c:null}function r(a,b,c){var d=[];for(b=b||a.config.editor;b&&b!==a.config.editor;)b.nodeName.match(G)&&d.push(c?b.nodeName.toLowerCase():b),b=b.parentNode;return d}function s(a,c){var d=a._range=a.getRange(),e=b.createElement("p");c&&(a.config.editor.innerHTML=""),e.innerHTML="<br>",d.insertNode(e),t(a,e.childNodes[0],d)}function t(a,b,c){c.setStartAfter(b),c.setEndBefore(b),c.collapse(!1),a.setRange(c)}function u(a){if(1===a.nodeType){if(I.notLink.test(a.tagName))return;B.forEach(a.childNodes,function(a){u(a)},!0)}else if(3===a.nodeType){var c=v(a.nodeValue||"");if(!c.links)return;var d=b.createDocumentFragment(),e=b.createElement("div");for(e.innerHTML=c.text;e.childNodes.length;)d.appendChild(e.childNodes[0]);a.parentNode.replaceChild(d,a)}}function v(a){var b=0;return a=a.replace(I.url,function(a){var c=a,d=a;return b++,a.length>I.maxLength&&(d=a.slice(0,I.maxLength)+"..."),I.prefix.test(c)||(c="http://"+c),'<a href="'+c+'">'+d+"</a>"}),{links:b,text:a}}function w(a,b){a.style.display=b?"none":"block"}function x(a){if(a.hasChildNodes())return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null}function y(a){var b=a.startContainer,c=a.endContainer;if(b===c)return[b];for(var d=[];b&&b!==c;)d.push(b=x(b));for(b=a.startContainer;b&&b!==a.commonAncestorContainer;)d.unshift(b),b=b.parentNode;return d}var z=void 0,A=void 0,B={},C=Object.prototype.toString,D=Array.prototype.slice,E={block:/^(?:p|h[1-6]|blockquote)$/,inline:/^(?:bold|italic|underline|insertorderedlist|insertunorderedlist|indent|outdent)$/,source:/^(?:createlink|unlink)$/,insert:/^(?:inserthorizontalrule|insertimage|insert)$/,wrap:/^(?:code)$/},F=/^(?:blockquote|pre|div|code)$/i,G=/(?:[pubia]|h[1-6]|blockquote|[uo]l|li|code)/i,H={whiteSpace:/(^\s+)|(\s+$)/g,mailTo:/^(?!mailto:|.+\/|.+#|.+\?)(.*@.*\..+)$/,http:/^(?!\w+?:\/\/|mailto:|\/|\.\/|\?|#)(.*)$/},I={url:/((https?|ftp):\/\/|www\.)[^\s<]{3,}/gi,prefix:/^(?:https?|ftp):\/\//i,notLink:/^(?:img|a|input|audio|video|source|code|pre|script|head|title|style)$/i,maxLength:100};B.is=function(a,b){return C.call(a).slice(8,-1)===b},B.forEach=function(a,b,c){if(a)if(null==c&&(c=B.is(a,"Array")),c)for(var d=0,e=a.length;e>d;d++)b(a[d],d,a);else for(var f in a)a.hasOwnProperty(f)&&b(a[f],f,a)},B.copy=function(a,b){return B.forEach(b,function(b,c){B.is(b,"Object")?a[c]=B.copy({},b):B.is(b,"Array")?a[c]=B.copy([],b):a[c]=b}),a},B.log=function(a,b){(z||b)&&console.log("%cPEN DEBUGGER: %c"+a,"font-family:arial,sans-serif;color:#1abf89;line-height:2em;","font-family:cursor,monospace;color:#333;")},B.delayExec=function(a){var b=null;return function(c){clearTimeout(b),b=setTimeout(function(){a()},c||1)}},B.merge=function(a){var c={"class":"pen",debug:!1,toolbar:null,stay:a.stay||!a.debug,stayMsg:"Are you going to leave here?",textarea:'<textarea name="content"></textarea>',list:["blockquote","h2","h3","p","code","insertorderedlist","insertunorderedlist","inserthorizontalrule","indent","outdent","bold","italic","underline","createlink","insertimage"],titles:{},cleanAttrs:["id","class","style","name"],cleanTags:["script"],linksInNewWindow:!1};return 1===a.nodeType?c.editor=a:a.match&&a.match(/^#[\S]+$/)?c.editor=b.getElementById(a.slice(1)):c=B.copy(c,a),c};var J=function(a){if(!a)throw new Error("Can't find config");z=a.debug;var b=B.merge(a),c=b.editor;if(!c||1!==c.nodeType)throw new Error("Can't find editor");c.classList.add(b["class"]),c.setAttribute("contenteditable","true"),this.config=b,b.placeholder&&c.setAttribute("data-placeholder",b.placeholder),n(this),this.selection=A,this._events={change:[]},h(this),i(this),this._prevContent=this.getContent(),this.markdown&&this.markdown.init(this),this.config.stay&&this.stay(this.config),this.config.input&&this.addOnSubmitListener(this.config.input)};J.prototype.on=function(a,b){return j(this,this.config.editor,a,b),this},J.prototype.addOnSubmitListener=function(a){var b=a.form,c=this;b.addEventListener("submit",function(){a.value=c.config.editor.innerHTML})},J.prototype.isEmpty=function(a){return a=a||this.config.editor,!(a.querySelector("img")||a.querySelector("blockquote")||a.querySelector("li")||o(a.textContent))},J.prototype.getContent=function(){return this.isEmpty()?"":o(this.config.editor.innerHTML)},J.prototype.setContent=function(a){return this.config.editor.innerHTML=a,this.cleanContent(),this},J.prototype.checkContentChange=function(){var a=this._prevContent,b=this.getContent();a!==b&&(this._prevContent=b,k(this,"change",b,a))},J.prototype.getRange=function(){var a=this.config.editor,c=A.rangeCount&&A.getRangeAt(0);return c&&p(a,c.commonAncestorContainer)||(c=b.createRange(),c.selectNodeContents(a),c.collapse(!1)),c},J.prototype.setRange=function(a){a=a||this._range,a||(a=this.getRange(),a.collapse(!1));try{A.removeAllRanges(),A.addRange(a)}catch(b){}return this},J.prototype.focus=function(a){return a||this.setRange(),this.config.editor.focus(),this},J.prototype.execCommand=function(a,h){if(a=a.toLowerCase(),"codeblock"===a)this.selection.focusNode.innerHTML="<code><br></code>",e(this,"pre");else if(E.block.test(a))e(this,a);else if(E.inline.test(a))c(this,a,h);else if(E.source.test(a))this.setRange(),g(this,a,h);else if(E.insert.test(a))this.setRange(),d(this,a,h);else if(E.wrap.test(a)){var i=y(this.selection.getRangeAt(0)),j=0;if(B.forEach(i,function(a){"P"===a.nodeName&&j++}),2>j){var k=r(this,this.selection.focusNode),l=void 0;if(B.forEach(k,function(a){"CODE"===a.nodeName&&(l=a)}),l){if(!c(this,"removeFormat")){var m=b.createDocumentFragment();B.forEach(l.childNodes,function(a){m.appendChild(a.cloneNode())}),l.replaceWith(m)}}else f(this,a,h)}}else B.log("can not find command function for name: "+a+(h?", value: "+h:""),!0);"indent"===a?this.checkContentChange():this.cleanContent({cleanAttrs:["style"]})},J.prototype.cleanContent=function(a){var b=this.config.editor;return a||(a=this.config),B.forEach(a.cleanAttrs,function(a){B.forEach(b.querySelectorAll("["+a+"]"),function(b){b.removeAttribute(a)},!0)},!0),B.forEach(a.cleanTags,function(a){B.forEach(b.querySelectorAll(a),function(a){a.parentNode.removeChild(a)},!0)},!0),n(this),this.checkContentChange(),this},J.prototype.autoLink=function(){return u(this.config.editor),this.getContent()},J.prototype.highlight=function(){var a=this._toolbar||this._menu,b=q(this);if(B.forEach(a.querySelectorAll(".active"),function(a){a.classList.remove("active")},!0),!b)return this;var c=r(this,b),d=this._inputBar;d&&a===this._menu&&(d.style.display="none",d.value="");var e=function(b){if(b){var c=a.querySelector("[data-action="+b+"]");return c&&c.classList.add("active")}};return B.forEach(c,function(a){var b=a.nodeName.toLowerCase();switch(b){case"a":d&&(d.value=a.getAttribute("href")),b="createlink";break;case"img":d&&(d.value=a.getAttribute("src")),b="insertimage";break;case"i":b="italic";break;case"u":b="underline";break;case"b":b="bold";break;case"pre":case"code":b="code";break;case"ul":b="insertunorderedlist";break;case"ol":b="insertorderedlist";break;case"li":b="indent"}e(b)},!0),this},J.prototype.menu=function(){if(!this._menu)return this;if(A.isCollapsed)return this._menu.style.display="none",this._inputActive=!1,this;if(this._toolbar&&(!this._inputBar||!this._inputActive))return this;var a=this._range.getBoundingClientRect(),b=10,c=a.top-b,d=a.left+a.width/2,e=this._menu,f={x:0,y:0},g=this._stylesheet;if(0===a.width&&0===a.height)return this;if(void 0===this._stylesheet){var h=document.createElement("style");document.head.appendChild(h),this._stylesheet=g=h.sheet}return e.style.display="block",f.x=d-e.clientWidth/2,f.y=c-e.clientHeight,g.cssRules.length>0&&g.deleteRule(0),f.x<0?(f.x=0,g.insertRule(".pen-menu:after {left: "+d+"px;}",0)):g.insertRule(".pen-menu:after {left: 50%; }",0),f.y<0?(e.classList.add("pen-menu-below"),f.y=a.top+a.height+b):e.classList.remove("pen-menu-below"),e.style.top=f.y+"px",e.style.left=f.x+"px",this},J.prototype.stay=function(a){var b=this;window.onbeforeunload||(window.onbeforeunload=function(){return b._isDestroyed?void 0:a.stayMsg})},J.prototype.destroy=function(a){var b=!a,c=a?"setAttribute":"removeAttribute";if(a)h(this),i(this);else{m(this);try{A.removeAllRanges(),this._menu&&this._menu.parentNode.removeChild(this._menu)}catch(d){}}return this._isDestroyed=b,this.config.editor[c]("contenteditable",""),this},J.prototype.rebuild=function(){return this.destroy("it's a joke")},a.Pen=function(a){if(!a)return B.log("can't find config",!0);var b=B.merge(a),c=b.editor.getAttribute("class");return c=c?c.replace(/\bpen\b/g,"")+" pen-textarea "+b["class"]:"pen pen-textarea",b.editor.setAttribute("class",c),b.editor.innerHTML=b.textarea,b.editor},J.prototype.toMd=function(){var a=this.getContent(),b=new TurndownService({codeBlockStyle:"fenced",headingStyle:"atx"});return b.turndown(a)},b.getSelection&&(A=b.getSelection(),a.Pen=J)}(window,document);